/**
*  PublishSubscribe
*  A simple publish-subscribe implementation for PHP, Python, Node/JS
*
*  @version: 0.3.1
*  https://github.com/foo123/PublishSubscribe
*
**/
!function(t,s,n){"object"==typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[s]=n()}(this,"PublishSubscribe",function(){"use strict";function t(t,s,n,i){var o=this;o.topic=t?[].concat(t):[],s&&(o.originalTopic=[].concat(s)),o.tags=n?[].concat(n):[],o.namespaces=i?[].concat(i):[],o.data={},o._stopPropagation=!1,o._stopEvent=!1}function s(){return{notopics:{notags:{namespaces:{},list:[]},tags:{}},topics:{}}}function n(t){return t.length>0}function i(t,s){var i,o,e,p;return s=String(s),i=s.indexOf(t[2]),o=s.indexOf(t[1]),i>-1?(p=s.slice(i).split(t[2]).filter(n).sort(),s=s.slice(0,i)):p=[],o>-1?(e=s.slice(o).split(t[1]).filter(n).sort(),s=s.slice(0,o)):e=[],s=s.split(t[0]).filter(n),[s,e,p]}function o(t,s){var n,o,e,p,l,a,c,u,r=[],g=[];for(s=i(t,s),n=s[2],o=s[1],s=s[0],e=s.length;e;)r.push(s.join(b)),s.pop(),e--;if(e=o.length,e>1){for(u=1<<e,p=u-1;p>=1;p--){for(c=[],l=0,a=1;e>l;l++,a=1<<l)p!==a&&p&a&&c.push(o[l]);c.length&&g.push(c.join(d))}g=g.concat(o)}else e&&g.push(o[0]);return[r.length?r[0]:"",r,g,n]}function e(t,s,n){var i,o;for(i=0;n>i;i++)o=s[i],o in t?t[o]++:t[o]=1}function p(t,s,n){var i,o;for(i=0;n>i;i++)o=s[i],o in t&&(t[o]--,t[o]<=0&&delete t[o])}function l(t,s,n){var i,o;for(i=0;n>i;i++)if(o=s[i],!(o in t)||0>=t[o])return!1;return!0}function a(t,s,n,i,o,e){if(n){if(i){if(e>0){if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length&&l(t.topics[n].tags[i].namespaces,o,e))return s.push([n,i,!0,t.topics[n].tags[i]]),!0}else if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length)return s.push([n,i,null,t.topics[n].tags[i]]),!0}else if(e>0){if(t.topics[n].notags.list.length&&l(t.topics[n].notags.namespaces,o,e))return s.push([n,null,!0,t.topics[n].notags]),!0}else if(t.topics[n].notags.list.length)return s.push([n,null,null,t.topics[n].notags]),!0}else if(i){if(e>0){if(i in t.notopics.tags&&t.notopics.tags[i].list.length&&l(t.notopics.tags[i].namespaces,o,e))return s.push([null,i,!0,t.notopics.tags[i]]),!0}else if(i in t.notopics.tags&&t.notopics.tags[i].list.length)return s.push([null,i,null,t.notopics.tags[i]]),!0}else if(e>0&&t.notopics.notags.list.length&&l(t.notopics.notags.namespaces,o,e))return s.push([null,null,!0,t.notopics.notags]),!0;return!1}function c(t,s,n){var i,e,p,l,c,u,r=o(t,n),g=r[1],f=r[2],h=r[3],v=r[0],m=[];if(c=f.length,u=h.length,i=g.length)for(;i;){if(e=g[0],s.topics[e])if(c>0)for(l=0;c>l;l++)p=f[l],a(s,m,e,p,h,u);else a(s,m,e,null,h,u);g.shift(),i--}if(c>0)for(l=0;c>l;l++)p=f[l],a(s,m,null,p,h,u);return a(s,m,null,null,h,u),[v,m,h]}function u(s,n,i,o){if(n){var e,a,u,r,g,f,h,v,m,_,y,P,j,$,E,T,x,O,k=c(s,n,i);for(v=k[0],y=k[2],j=y.length,k=k[1],u=k.length,$=null,u>0&&($=new t,$.originalTopic=v?v.split(b):[]),e=0;u>e;e++){for(m=k[e][0],_=k[e][1],$.topic=m?m.split(b):[],$.tags=_?_.split(d):[],P=k[e][2],f=k[e][3],g=[],E=[],r=f.list.length,a=0;r>a;a++)(!P||f.list[a][2]&&l(f.list[a][2],y,j))&&(f.list[a][1]&&E.push(a),g.push(f.list[a]));for(;E.length;)x=E.pop(),f.list[x][2]&&(O=S(f.list[x][2]),p(f.namespaces,O,O.length)),f.list.splice(x,1);for(r=g.length,a=0;r>a&&(h=g[a],$.namespaces=P?h[3].slice(0):[],T=h[0]($,o),!1!==T&&!$.eventStopped());a++);if($.propagationStopped())break}$&&($.dispose(),$=null)}}function r(t,s,n,o,p){if(s&&"function"==typeof o){n=i(t,n);var l,a,c,u=n[1].join(d),r=u.length,g=n[2],f=g.length;if(n=n[0].join(b),p=!0===p,l={},f)for(c=0;f>c;c++)l[g[c]]=1;a=g.slice(0),n.length?(n in s.topics||(s.topics[n]={notags:{namespaces:{},list:[]},tags:{}}),r?(u in s.topics[n].tags||(s.topics[n].tags[u]={namespaces:{},list:[]}),f?(s.topics[n].tags[u].list.push([o,p,l,a]),e(s.topics[n].tags[u].namespaces,g,f)):s.topics[n].tags[u].list.push([o,p,!1,[]])):f?(s.topics[n].notags.list.push([o,p,l,a]),e(s.topics[n].notags.namespaces,g,f)):s.topics[n].notags.list.push([o,p,!1,[]])):r?(u in s.notopics.tags||(s.notopics.tags[u]={namespaces:{},list:[]}),f?(s.notopics.tags[u].list.push([o,p,l,a]),e(s.notopics.tags[u].namespaces,g,f)):s.notopics.tags[u].list.push([o,p,!1,[]])):f&&(s.notopics.notags.list.push([o,p,l,a]),e(s.notopics.notags.namespaces,g,f))}}function g(t,s,n,i,o){var e,a=t.list.length;if(s){if(null!=n&&a>0)for(;--a>=0;)n===t.list[a][0]&&(o&&t.list[a][2]&&l(t.list[a][2],i,o)?(e=S(t.list[a][2]),p(t.namespaces,e,e.length),t.list.splice(a,1)):o||(t.list[a][2]&&(e=S(t.list[a][2]),p(t.namespaces,e,e.length)),t.list.splice(a,1)))}else if(!s&&o>0&&a>0)for(;--a>=0;)t.list[a][2]&&l(t.list[a][2],i,o)&&(e=S(t.list[a][2]),p(t.namespaces,e,e.length),t.list.splice(a,1));else!s&&a>0&&(t.list=[],t.namespaces={})}function f(t,s,n,o){if(s){n=i(t,n);var e,p,l,a,c=n[1].join(d),u=n[2],r=c.length,f=u.length;if(n=n[0].join(b),l=n.length,a=!(!o||"function"!=typeof o),a||(o=null),l&&n in s.topics)r&&c in s.topics[n].tags?(g(s.topics[n].tags[c],a,o,u,f),s.topics[n].tags[c].list.length||delete s.topics[n].tags[c]):r||g(s.topics[n].notags,a,o,u,f),s.topics[n].notags.list.length||S(s.topics[n].tags).length||delete s.topics[n];else if(!l&&(r||f))if(r){c in s.notopics.tags&&(g(s.notopics.tags[c],a,o,u,f),s.notopics.tags[c].list.length||delete s.notopics.tags[c]);for(e in s.topics)c in s.topics[e].tags&&(g(s.topics[e].tags[c],a,o,u,f),s.topics[e].tags[c].list.length||delete s.topics[e].tags[c])}else{g(s.notopics.notags,a,o,u,f);for(p in s.notopics.tags)g(s.notopics.tags[p],a,o,u,f),s.notopics.tags[p].list.length||delete s.notopics.tags[p];for(e in s.topics){g(s.topics[e].notags,a,o,u,f);for(p in s.topics[e].tags)g(s.topics[e].tags[p],a,o,u,f),s.topics[e].tags[p].list.length||delete s.topics[e].tags[p]}}}}var h="0.3.1",v="/",m="#",_="@",b="/",d="#",S=Object.keys;t.prototype={constructor:t,topic:null,originalTopic:null,tags:null,namespaces:null,data:null,_stopPropagation:!1,_stopEvent:!1,dispose:function(){var t=this;return t.topic=null,t.originalTopic=null,t.tags=null,t.namespaces=null,t.data=null,t._stopPropagation=!0,t._stopEvent=!0,t},propagate:function(t){return arguments.length||(t=!0),this._stopPropagation=!t,this},stop:function(t){return arguments.length||(t=!0),this._stopEvent=!!t,this},propagationStopped:function(){return this._stopPropagation},eventStopped:function(){return this._stopEvent}};var y=function(){return this instanceof y?void this.initPubSub():new y};return y.VERSION=h,y.Event=t,y.prototype={constructor:y,_seps:null,_pubsub$:null,initPubSub:function(){var t=this;return t._seps=[v,m,_],t._pubsub$=s(),t},disposePubSub:function(){var t=this;return t._seps=null,t._pubsub$=null,t},setSeparators:function(t){if(t){var s=t.length;s>0&&t[0]&&(this._seps[0]=t[0]),s>1&&t[1]&&(this._seps[1]=t[1]),s>2&&t[2]&&(this._seps[2]=t[2])}return this},trigger:function(t,s,n){var i=this;return 3>arguments.length&&(n=0),n=+n,s=s||{},n>0?setTimeout(function(){u(i._seps,i._pubsub$,t,s)},n):u(i._seps,i._pubsub$,t,s),i},on:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s),n},one:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0),n},off:function(t,s){var n=this;return f(n._seps,n._pubsub$,t,s||null),n}},y});